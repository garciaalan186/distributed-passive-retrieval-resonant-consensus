Installing test dependencies...
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: pytest in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (8.4.2)
Requirement already satisfied: fakeredis in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (2.32.1)
Requirement already satisfied: httpx in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (0.28.1)
Requirement already satisfied: pytest-asyncio in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (1.2.0)
Requirement already satisfied: redis in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (7.0.1)
Requirement already satisfied: fastapi in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (0.124.4)
Requirement already satisfied: uvicorn in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (0.38.0)
Requirement already satisfied: pygments>=2.7.2 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pytest) (2.19.2)
Requirement already satisfied: pluggy<2,>=1.5 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pytest) (1.6.0)
Requirement already satisfied: packaging>=20 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pytest) (25.0)
Requirement already satisfied: exceptiongroup>=1 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pytest) (1.3.1)
Requirement already satisfied: iniconfig>=1 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pytest) (2.1.0)
Requirement already satisfied: tomli>=1 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pytest) (2.3.0)
Requirement already satisfied: typing-extensions~=4.7 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from fakeredis) (4.15.0)
Requirement already satisfied: sortedcontainers>=2 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from fakeredis) (2.4.0)
Requirement already satisfied: idna in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from httpx) (3.4)
Requirement already satisfied: httpcore==1.* in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from httpx) (1.0.9)
Requirement already satisfied: certifi in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from httpx) (2023.5.7)
Requirement already satisfied: anyio in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from httpx) (4.12.0)
Requirement already satisfied: h11>=0.16 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from httpcore==1.*->httpx) (0.16.0)
Requirement already satisfied: backports-asyncio-runner<2,>=1.1 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pytest-asyncio) (1.2.0)
Requirement already satisfied: async-timeout>=4.0.3 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from redis) (5.0.1)
Requirement already satisfied: annotated-doc>=0.0.2 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from fastapi) (0.0.4)
Requirement already satisfied: pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from fastapi) (2.12.5)
Requirement already satisfied: starlette<0.51.0,>=0.40.0 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from fastapi) (0.49.3)
Requirement already satisfied: click>=7.0 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from uvicorn) (8.1.8)
Requirement already satisfied: pydantic-core==2.41.5 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi) (2.41.5)
Requirement already satisfied: annotated-types>=0.6.0 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi) (0.7.0)
Requirement already satisfied: typing-inspection>=0.4.2 in /Users/alangarcia/Library/Python/3.9/lib/python/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi) (0.4.2)
WARNING: You are using pip version 21.2.4; however, version 25.3 is available.
You should consider upgrading via the '/Applications/Xcode.app/Contents/Developer/usr/bin/python3 -m pip install --upgrade pip' command.
Running Unit Tests...
============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-8.4.2, pluggy-1.6.0 -- /Applications/Xcode.app/Contents/Developer/usr/bin/python3
cachedir: .pytest_cache
rootdir: /Users/alangarcia/Documents/dpr-rc
plugins: asyncio-1.2.0, anyio-4.12.0
asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... 
A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.0.2 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with 'pybind11>=2.12'.

If you are a user of the module, the easiest solution will be to
downgrade to 'numpy<2' or try to upgrade the affected module.
We expect that some modules will need time to support NumPy 2.

Traceback (most recent call last):  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pytest/__main__.py", line 9, in <module>
    raise SystemExit(pytest.console_main())
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/config/__init__.py", line 201, in console_main
    code = main()
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/config/__init__.py", line 175, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
    return wrap_session(config, _main)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/main.py", line 289, in wrap_session
    session.exitstatus = doit(config, session) or 0
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/main.py", line 342, in _main
    config.hook.pytest_collection(session=session)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/main.py", line 353, in pytest_collection
    session.perform_collect()
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/main.py", line 813, in perform_collect
    self.items.extend(self.genitems(node))
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/main.py", line 974, in genitems
    rep, duplicate = self._collect_one_node(node, handle_dupes)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/main.py", line 839, in _collect_one_node
    rep = collect_one_node(node)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 567, in collect_one_node
    rep: CollectReport = ihook.pytest_make_collect_report(collector=collector)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 391, in pytest_make_collect_report
    call = CallInfo.from_call(
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 344, in from_call
    result: TResult | None = func()
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 389, in collect
    return list(collector.collect())
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 554, in collect
    self._register_setup_module_fixture()
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 567, in _register_setup_module_fixture
    self.obj, ("setUpModule", "setup_module")
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 280, in obj
    self._obj = obj = self._getobj()
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 551, in _getobj
    return importtestmodule(self.path, self.config)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 498, in importtestmodule
    mod = import_path(
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/pathlib.py", line 587, in import_path
    importlib.import_module(module_name)
  File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/_pytest/assertion/rewrite.py", line 186, in exec_module
    exec(co, module.__dict__)
  File "/Users/alangarcia/Documents/dpr-rc/tests/test_passive_unit.py", line 4, in <module>
    from dpr_rc.passive_agent import PassiveWorker, redis_client, RFI_STREAM, EventType
  File "/Users/alangarcia/Documents/dpr-rc/dpr_rc/passive_agent.py", line 6, in <module>
    import torch
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/torch/__init__.py", line 1477, in <module>
    from .functional import *  # noqa: F403
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/torch/functional.py", line 9, in <module>
    import torch.nn.functional as F
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/torch/nn/__init__.py", line 1, in <module>
    from .modules import *  # noqa: F403
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/torch/nn/modules/__init__.py", line 35, in <module>
    from .transformer import TransformerEncoder, TransformerDecoder, \
  File "/Users/alangarcia/Library/Python/3.9/lib/python/site-packages/torch/nn/modules/transformer.py", line 20, in <module>
    device: torch.device = torch.device(torch._C._get_default_device()),  # torch.device('cpu'),
An error occurred: module 'importlib.metadata' has no attribute 'packages_distributions'
collected 5 items

tests/test_active_unit.py::test_route_logic PASSED
tests/test_active_unit.py::test_query_broadcast {"timestamp": 1765690078.28327, "level": "INFO", "name": "ActiveAgentController", "message": "{\"trace_id\": \"test_trace_1\", \"timestamp\": 1765690078.280721, \"component\": \"ActiveAgentController\", \"event_type\": \"System_Init\", \"payload_hash\": \"6c485b0a8df2005d\", \"metrics\": {}, \"message\": \"{'query_text': 'testing query', 'trace_id': 'test_trace_1', 'timestamp_context': '2020-01-01'}\"}"}
{"timestamp": 1765690078.284149, "level": "INFO", "name": "ActiveAgentController", "message": "{\"trace_id\": \"test_trace_1\", \"timestamp\": 1765690078.284082, \"component\": \"ActiveAgentController\", \"event_type\": \"RFI_Broadcast\", \"payload_hash\": \"0cca943cfb64f788\", \"metrics\": {}, \"message\": \"{'trace_id': 'test_trace_1', 'query_text': 'testing query', 'target_shards': '[\\\"shard_2020\\\"]', 'timestamp_context': '2020-01-01'}\"}"}
{"timestamp": 1765690083.372579, "level": "INFO", "name": "ActiveAgentController", "message": "{\"trace_id\": \"test_trace_1\", \"timestamp\": 1765690083.372443, \"component\": \"ActiveAgentController\", \"event_type\": \"Hallucination_Detected\", \"payload_hash\": \"c742774ec03bec28\", \"metrics\": {}, \"message\": \"{'reason': 'No votes received'}\"}"}
PASSED
tests/test_active_unit.py::test_consensus_logic_superposition {"timestamp": 1765690083.381609, "level": "INFO", "name": "ActiveAgentController", "message": "{\"trace_id\": \"t1\", \"timestamp\": 1765690083.3814971, \"component\": \"ActiveAgentController\", \"event_type\": \"System_Init\", \"payload_hash\": \"02cb8f1e305ce0ee\", \"metrics\": {}, \"message\": \"{'query_text': 'What is truth?', 'trace_id': 't1', 'timestamp_context': None}\"}"}
{"timestamp": 1765690083.3822951, "level": "INFO", "name": "ActiveAgentController", "message": "{\"trace_id\": \"t1\", \"timestamp\": 1765690083.382231, \"component\": \"ActiveAgentController\", \"event_type\": \"RFI_Broadcast\", \"payload_hash\": \"80db4734293a4679\", \"metrics\": {}, \"message\": \"{'trace_id': 't1', 'query_text': 'What is truth?', 'target_shards': '[\\\"broadcast\\\"]', 'timestamp_context': None}\"}"}
FAILED
tests/test_passive_unit.py::test_passive_worker_processing {"timestamp": 1765690084.171628, "level": "INFO", "name": "PassiveAgentWorker", "message": "{\"trace_id\": \"trace_123\", \"timestamp\": 1765690084.171502, \"component\": \"PassiveAgentWorker\", \"event_type\": \"Vote_Cast\", \"payload_hash\": \"71d61c32fd3bf9b8\", \"metrics\": {\"confidence\": 0.9}, \"message\": \"{'trace_id': 'trace_123', 'worker_id': 'worker-8637', 'content_hash': '52239552ea17ece5', 'confidence_score': 0.9, 'semantic_quadrant': [0.03, 0.49], 'content_snippet': 'Historic Event A occurred in 2\"}"}
PASSED
tests/test_passive_unit.py::test_passive_worker_no_result PASSED

=================================== FAILURES ===================================
______________________ test_consensus_logic_superposition ______________________

    def test_consensus_logic_superposition():
        # We need to test the logic INSIDE handle_query for consensus.
        # Since it's an async FastAPI route, we can mock the redis pubsub to return votes
    
        votes_data = [
            # 3 votes for "Fact A" (Consensus)
            ConsensusVote(trace_id="t1", worker_id="w1", content_hash="h1", confidence_score=0.9, semantic_quadrant=[0.9,0.9], content_snippet="Fact A").model_dump(),
            ConsensusVote(trace_id="t1", worker_id="w2", content_hash="h1", confidence_score=0.92, semantic_quadrant=[0.9,0.9], content_snippet="Fact A").model_dump(),
            ConsensusVote(trace_id="t1", worker_id="w3", content_hash="h1", confidence_score=0.88, semantic_quadrant=[0.9,0.9], content_snippet="Fact A").model_dump(),
    
            # 1 vote for "Fact B" (Perspective)
            ConsensusVote(trace_id="t1", worker_id="w4", content_hash="h2", confidence_score=0.65, semantic_quadrant=[0.2,0.5], content_snippet="Fact B").model_dump(),
        ]
    
        with patch("dpr_rc.active_agent.redis_client") as mock_redis:
            mock_pubsub = MagicMock()
            mock_redis.pubsub.return_value = mock_pubsub
    
            # Simulate pubsub returning messages then None
            messages = [
                {"data": json.dumps(v)} for v in votes_data
            ]
            # function to yield messages then StopIteration-ish behavior (return None)
            mock_pubsub.get_message.side_effect = messages + [None, None, None, None, None]
    
            # We assume the route uses redis_client global.
            # Calling the endpoint via TestClient:
>           response = client.post("/query", json={
                "query_text": "What is truth?",
                "trace_id": "t1"
            })

tests/test_active_unit.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:552: in post
    return super().post(
../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1144: in post
    return self.request(
../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:451: in request
    return super().request(
../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:326: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:257: in _call_func
    retval = await retval_or_awaitable
../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1139: in __call__
    await super().__call__(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:120: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:106: in app
    response = await f(request)
../../Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:452: in app
    content = await serialize_response(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    async def serialize_response(
        *,
        field: Optional[ModelField] = None,
        response_content: Any,
        include: Optional[IncEx] = None,
        exclude: Optional[IncEx] = None,
        by_alias: bool = True,
        exclude_unset: bool = False,
        exclude_defaults: bool = False,
        exclude_none: bool = False,
        is_coroutine: bool = True,
        endpoint_ctx: Optional[EndpointContext] = None,
    ) -> Any:
        if field:
            errors = []
            if not hasattr(field, "serialize"):
                # pydantic v1
                response_content = _prepare_response_content(
                    response_content,
                    exclude_unset=exclude_unset,
                    exclude_defaults=exclude_defaults,
                    exclude_none=exclude_none,
                )
            if is_coroutine:
                value, errors_ = field.validate(response_content, {}, loc=("response",))
            else:
                value, errors_ = await run_in_threadpool(
                    field.validate, response_content, {}, loc=("response",)
                )
            if isinstance(errors_, list):
                errors.extend(errors_)
            elif errors_:
                errors.append(errors_)
            if errors:
                ctx = endpoint_ctx or EndpointContext()
>               raise ResponseValidationError(
                    errors=_normalize_errors(errors),
                    body=response_content,
                    endpoint_ctx=ctx,
                )
E               fastapi.exceptions.ResponseValidationError: 1 validation error:
E                 {'type': 'model_attributes_type', 'loc': ('response',), 'msg': 'Input should be a valid dictionary or object to extract fields from', 'input': None}
E               
E                 File "/Users/alangarcia/Documents/dpr-rc/dpr_rc/active_agent.py", line 56, in handle_query
E                   POST /query

../../Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:278: ResponseValidationError
=============================== warnings summary ===============================
../../Library/Python/3.9/lib/python/site-packages/pythonjsonlogger/jsonlogger.py:11
  /Users/alangarcia/Library/Python/3.9/lib/python/site-packages/pythonjsonlogger/jsonlogger.py:11: DeprecationWarning: pythonjsonlogger.jsonlogger has been moved to pythonjsonlogger.json
    warnings.warn(

../../Library/Python/3.9/lib/python/site-packages/google/api_core/_python_version_support.py:252
  /Users/alangarcia/Library/Python/3.9/lib/python/site-packages/google/api_core/_python_version_support.py:252: FutureWarning: You are using a Python version (3.9.6) past its end of life. Google will update google.api_core with critical bug fixes on a best-effort basis, but not with any other fixes or features. Please upgrade to the latest Python version, or at least Python 3.10, and then update google.api_core.
    warnings.warn(message, FutureWarning)

../../Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:34
  /Users/alangarcia/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:34: NotOpenSSLWarning: urllib3 v2.0 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
    warnings.warn(

../../Library/Python/3.9/lib/python/site-packages/torch/nn/modules/transformer.py:20
  /Users/alangarcia/Library/Python/3.9/lib/python/site-packages/torch/nn/modules/transformer.py:20: UserWarning: Failed to initialize NumPy: _ARRAY_API not found (Triggered internally at /Users/runner/work/pytorch/pytorch/pytorch/torch/csrc/utils/tensor_numpy.cpp:84.)
    device: torch.device = torch.device(torch._C._get_default_device()),  # torch.device('cpu'),

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_active_unit.py::test_consensus_logic_superposition - fastap...
=================== 1 failed, 4 passed, 4 warnings in 19.10s ===================
